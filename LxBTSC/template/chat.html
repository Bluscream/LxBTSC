<!DOCTYPE HTML>
<html>
    <head>
        <meta charset='utf-8'>
        <meta name='viewport' content='width=device-width, initial-scale=1.0'>
        <link rel = 'stylesheet' type='text/css' href='style.css'/>
        <!--<link rel = 'stylesheet' type='text/css' href='emote.css'/>-->
        <script src="jquery-3.2.1.min.js" type="text/javascript"></script>
        <script type="application/json" id="emotes">
            {
                "Kappa": { "name":"Kappa.png" },
                "SourPls": { "name":"SourPls.gif" },
                "BibleThump": { "name":"BibleThump.png" },
                "WutFace": { "name":"WutFace.png" },
                "PogChamp": { "name":"PogChamp.png" },
                "ResidentSleeper": { "name":"ResidentSleeper.png" },
                "FeelsAmazingMan": { "name":"FeelsAmazingMan.png" },
                "FeelsBadMan": { "name":"FeelsBadMan.png" },
                "FeelsGoodMan": { "name":"FeelsGoodMan.png" },
                "LUL": { "name":"LUL.png" },
                "Kreygasm": { "name":"Kreygasm.png" },
                "RamKiss": { "name":"RamKiss.png" },
                "RemKiss": { "name":"RemKiss.png" },
                "BiriBlush": { "name":"BiriBlush.gif" },
                "RikkaWoop": { "name":"RikkaWoop.gif" },
                "NillaWag": { "name":"NillaWag.gif" },
                "Tutturu": { "name":"Tutturu.png" },
                "AkaWalk": { "name":"AkaWalk.gif" },
                "MikuStare": { "name":"MikuStare.png" },
                "9cirno9": { "name":"9cirno9.png" },
                "MareWish": { "name":"MareWish.png" },
                "VivioWife": { "name":"VivioWife.png" },
                "EinhartYuri": { "name":"EinhartYuri.png" },
                "NightKud": { "name":"NightKud.png" },
                "DogeZ": { "name":"DogeZ.png" },
                "KinKaren": { "name":"KinKaren.png" },
                "Kabooto": { "name":"Kabooto.png" },
                "NekoRin": { "name":"NekoRin.png" },
                "FairyRenge": { "name":"FairyRenge.png" },
                "ChickenRappi": { "name":"ChickenRappi.png" },
                "UsagigaNigeteru": { "name":"UsagigaNigeteru.png" },
                "NoulShiro": { "name":"NoulShiro.png" },
                "Shyppa": { "name":"Shyppa.png" },
                "HamsterImouto": { "name":"HamsterImouto.png" },
                "ImoutosHamster": { "name":"ImoutosHamster.png" },
                "ShakeKuma": { "name":"ShakeKuma.png" },
                "ShiroKuma": { "name":"ShiroKuma.png" },
                "MireiCute": { "name":"MireiCute.png" },
                "LostRen": { "name":"LostRen.png" },
                "FeitoFeico": { "name":"FeitoFeico.png" },
                "FeitoChesto": { "name":"FeitoChesto.png" },
                "FeitoLegso": { "name":"FeitoLegso.png" },
                "FeitoFeeto": { "name":"FeitoFeeto.png" },
                "AiShiteru": { "name":"AiShiteru.png" },
                "&lt;3": { "name":"AiShiteru.png" },
                "ShinkuWish": { "name":"ShinkuWish.png" },
                "ShinMea1": { "name":"ShinMea1.png" },
                "ShinMea2": { "name":"ShinMea2.png" },
                "ShinMea3": { "name":"ShinMea3.png" },
                "ShinLeft": { "name":"ShinLeft.png" },
                "ShinRight": { "name":"ShinRight.png" },
                "MeaLeft": { "name":"MeaLeft.png" },
                "MeaRight": { "name":"MeaRight.png" },
                "RikaPassion": { "name":"RikaPassion.png" },
                "KirinoYome": { "name":"KirinoYome.png" },
                "YoshinoHime": { "name":"YoshinoHime.png" },
                "RikaCh": { "name":"RikaCh.png" },
                "ampFull": { "name":"ampFull.png" },
                "ClaireScarlet": { "name":"ClaireScarlet.png" },
                "KuonLog": { "name":"KuonLog.png" },
                "KanoHana": { "name":"KanoHana.png" },
                "MiniK": { "name":"MiniK.png" },
                "RikuStare": { "name":"RikuStare.png" },
                "Wing1": { "name":"Wing1.png" },
                "Wing2": { "name":"Wing2.png" },
                "MeiK": { "name":"MeiK.png" },
                "oreD": { "name":"oreD.png" },
                "aaa-": { "name":"aaa-.png" },
                "ShakeBoko": { "name":"ShakeBoko.png" },
                "MareThump": { "name":"MareThump.png" },
                "FeelsBadMare": { "name":"FeelsBadMare.png" },
                "ArisaMoe": { "name":"ArisaMoe.png" },
                "MofuNuko": { "name":"MofuNuko.png" },
                "BlueShinku": { "name":"BlueShinku.png" },
                "AmaFloat": { "name":"AmaFloat.png" },
                "EUkun": { "name":"EUkun.png" },
                "D:": { "name":"D.png" },
                ":thinking:": { "name":"thinking.png" },
                "HypeSplosion": { "name":"HypeSplosion.png" },
                "TSSalt": { "name":"TSSalt.png" },
                "NeverLucky": { "name":"NeverLucky.png" },
                "NeverS": { "name":"NeverS.png" },
                "Loominati": { "name":"Loominati.png" },
                "SingleGee": { "name":"SingleGee.png" },
                "BanHammer": { "name":"BanHammer.png" },
                "ItsaTrap": { "name":"ItsaTrap.png" },
                "panicBasket": { "name":"panicBasket.png" },
                "nepSmug": { "name":"nepSmug.png" },
                "ABABABABA": { "name":"ABABABABA.png" },
                "TabeRu": { "name":"Taberu2x.gif" },
                "topNep": { "name":"topNep.png" }
            }
        </script>

        <script type = 'text/javascript' >
            var server;
            var main;
            var emotes;
        var IsBottom = true;
        window.onload = function()
        {
            main = $('#main');
            emotes = JSON.parse($('#emotes').html());
        };
        
        window.onscroll = function(ev)
        {
            if ((window.innerHeight + window.pageYOffset) >= document.body.offsetHeight)
            {
                IsBottom = true;
                console.log("bottom");
            }
            else
            {
                IsBottom = false;
                console.log("not bottom");
            }
        };

        function AddServer(serverId)
        {
            if (!$(`.tab-${serverId}-server`).length)
            {
                main.append(`<div class='tab-${serverId}-server'></div><div class='tab-${serverId}-channel'></div>`);
            }
            ShowTarget(`tab-${serverId}-server`);
        }

        function AddLine(target, line)
        {
            if (!$(`.${target}`).length)
            {
                main.append(`<div class='${target}' style='display: none;'></div>`);
            }
            if ($(`.${target}`).childElementCount > 500)
            {
                $(`.${target}`).firstElementChild.remove();
            }
            //$(`.${target}`).append(line);
            //$(`.${target}`).append(Emoticonize(line));
            $(`.${target}`).append(EmbedYoutube(Emoticonize(line)));
            if (IsBottom)
            {
                window.scroll(0, document.body.scrollHeight);
            }
        }

        function ShowTarget(target)
        {
            if (!$(`.${target}`).length)
            {
                main.append(`<div class='${target}' style='display: none;'></div>`);
            }
            $('[class^="tab"]').hide();
            $(`.${target}`).show();
            window.scroll(0, document.body.scrollHeight);
        }

        function Emoticonize(line)
        {
            Object.keys(emotes).forEach(function(key) {
                line = line.replace(new RegExp("(?!<a[^>]*?>)("+key+")(?![^<]*?</a>)", 'g'), '<img class="emote" src="Emotes/'+emotes[key].name+'" alt="'+key+'">');
            });
            return line;
        }

        function EmbedYoutube(line)
        {
            var yt = /http(?:s?):\/\/(?:www\.)?youtu(?:be\.com\/watch\?v=|\.be\/)([\w-]*)(&(amp;)?[\w\?=]*)?/;
            var m = line.match(yt);
                console.log(m);
            if (m)
            {
                line += '</br><iframe frameborder="0" src="https://www.youtube.com/embed/'+ m[1] +'" ></iframe>';
            }
            return line;
        }
        </script>
    </head>
    <body id='main'>
    </body>
</html>