<!DOCTYPE HTML>
<html>
    <head>
        <meta charset='utf-8'>
        <meta name='viewport' content='width=device-width, initial-scale=1.0'>
        <link rel = 'stylesheet' type='text/css' href='style.css'/>
        <link rel = 'stylesheet' type='text/css' href='emote.css'/>
        <script src="jquery-3.2.1.min.js" type="text/javascript"></script>

        <script type = 'text/javascript' >
            var server;
            var main;
            var i = 0;
        var IsBottom = true;
        window.onload = function()
        {
            //main = document.getElementById('main');
            main = $('#main');
            //server = document.getElementById('server-tab');
        };
        window.onscroll = function(ev)
        {
            if ((window.innerHeight + window.pageYOffset) >= document.body.offsetHeight)
            {
                IsBottom = true;
                console.log("bottom");
            }
            else
            {
                IsBottom = false;
                console.log("not bottom");
            }
        };
        function AddServerLine(line)
        {
            if (server.childElementCount > 500)
            {
                server.firstElementChild.remove();
            }
            server.insertAdjacentHTML('beforeend', line);
            if (IsBottom)
            {
                window.scroll(0, document.body.scrollHeight);
            }
        }

        function AddServer(serverId)
        {
            if (!$(`.tab-${serverId}-server`).length)
            {
                main.append(`<div class='tab-${serverId}-server'></div><div class='tab-${serverId}-channel'></div>`);
            }
            ShowTarget(`tab-${serverId}-server`);
        }

        function AddLine(target, line)
        {
            if (!$(`.${target}`).length)
            {
                main.append(`<div class='${target}' style='display: none;'></div>`);
            }
            if ($(`.${target}`).childElementCount > 500)
            {
                $(`.${target}`).firstElementChild.remove();
            }
            $(`.${target}`).append(line);
            if (IsBottom)
            {
                window.scroll(0, document.body.scrollHeight);
            }
        }

        function ShowTarget(target)
        {
            if (!$(`.${target}`).length)
            {
                main.append(`<div class='${target}' style='display: none;'></div>`);
            }
            $('[class^="tab"]').hide();
            $(`.${target}`).show();
        }

        /*function AddChannelLine(line)
        {
            if (channel.childElementCount > 500)
            {
                channel.firstElementChild.remove();
            }
            channel.insertAdjacentHTML('beforeend', line);
            if (IsBottom)
            {
                window.scroll(0, document.body.scrollHeight);
            }
        }*/

        /*function TestAdd(string)
        {
            callbackObj.receiveMessage(string);
        }*/
        /*function IsBottom()
        {
            window.onscroll = function(ev) {
                if ((window.innerHeight + window.pageYOffset) >= document.body.offsetHeight)
                {
                }
            };
        }*/
        /*function ChangeTab(active)
        {
            if (active === 'server')
            {
                channel.style.display = 'none';
                server.style.display = 'block';
                return;
            }
            if (active === 'channel')
            {
                server.style.display = 'none';
                channel.style.display = 'block';
            }
        }*/
        </script>
    </head>
    <body id='main'>
    </body>
</html>